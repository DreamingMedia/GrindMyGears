<html>
	<head>
	<script src="./jquery-2.1.1.min.js"></script>
	<script src="./jQueryRotate.js"></script>
	
	<script>
		
		$.fn.observe = function(eventName, callback) {
    return this.each(function(){
        var el = this;
        $(document).on(eventName, function(){
            callback.apply(el, arguments);
        })
    })
}
		
		$( document ).ready( function(){
			
			var gear2 = $('#gear2')
			var driverGear = $('#driverGear')
			
			gear2.rotate( {angle:0} )
			driverGear.rotate( {angle:0} )
			
			var xOriginalDriverGear = driverGear.position().left
			console.log( 'xOriginalDriverGear' )
			console.log( xOriginalDriverGear )
			
			
			
			
			
			$("#gear1").rotate({bind:{
      	click: function(){
      		var $obj = $(this )
      		var lastAngle = $obj.getRotateAngle()[0]
          $(this).rotate({
            angle: 0, 
            animateTo: 90,
            duration:1000, //(10 * 100 * 8) * 10 ,
            easing: function(x, t, b, c, d) { return b+(t/d)*c ; },
            step: function( a ){ 
            		var angleDelta = $obj.getRotateAngle()[0] - lastAngle            		
            		lastAngle = $obj.getRotateAngle()[0]
            		var arcLength = Math.abs( (2 * parseFloat($obj.attr('radius')) * Math.PI) * (angleDelta / 360.0) )
            		$obj.trigger( 'rotate', { 'arcLength' : arcLength, 'a' : a } )
            		  
            		},
          })
      }
  }
})

		$('#gear2').observe( 'rotate', function( e , d ) { 
			
			//console.log( 'in gear 2: arcLength =  ' + d.arcLength  )
			var angleDelta = ( d.arcLength/(2 * parseFloat($(this).attr('radius')) * Math.PI) ) * 360
			//console.log( $(this).getRotateAngle()[0] )
			var newAngle =  $(this).getRotateAngle()[0] -  angleDelta 
			//console.log( angleDelta )
			
			//console.log( -1 * newAngle % 360 + '  ' + $('#gear1').getRotateAngle()[0] % 360 )
			var myAngle = -1 * newAngle % 360
			var driverGear = $('#gear1') 
			var driverGearAngle = driverGear.getRotateAngle()[0] % 360
			if ( Math.abs( 270 - myAngle ) < 2  &&  Math.abs( 270 - driverGearAngle ) < 2 ) {
				alert( 'got it' )
			}
			
			
			$(this).rotate( {angle: newAngle} )

			// figure out the position of the dirver gear
			// and then make my X location, just to the right 
			// of the driver gear.
			xDriverGear = driverGear.position().left

			
			
			}
		)
		
		$('#grow' ).click( function(){
				
				var $obj = $('#gear1' )				
				$obj.attr('radius', parseInt( $obj.attr('radius') ) + 2)
				$obj.attr('width', parseInt( $obj.attr('radius') ) * 10)
				
				console.log( $obj.attr('radius') )
				
			})

		$('#shrink' ).click( function(){
				var $obj = $('#gear1' )				
				$obj.attr('radius', parseInt( $obj.attr('radius') ) - 2)
				$obj.attr('width', parseInt( $obj.attr('radius') ) * 10)

			})
			
		} )
		
		</script>
	</head>
	<body>
		
		<a id="grow" href="#">grow me</a>
		<a id="shrink" href="#">shrink me</a>
		<br>		<br>		<br>		<br>		<br>
		<table>
			<tr>
			<td valign="center"><img src="g1.png" id="driverGear" width="100" style="position:absolute;left:100px;top:50px" radius="10" /></td>
			<td valign="center"><img src="g3.png" id="gear2" width="200" style="position:absolute;left:300px;top:50px" radius="20"/></td>
		
			</tr>
		</table>
		
		
	</body>
</html>